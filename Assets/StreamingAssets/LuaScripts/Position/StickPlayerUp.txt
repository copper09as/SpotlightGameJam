local DM = CS.DetectionManager

function StickPlayerUp(entity)
    local tag = "Player"
	local data = entity.dataTable
    local hitEntityPos = entity.transform.position
	local halfWidth = entity.col.bounds.extents.x
	local halfHeight = entity.col.bounds.extents.y
    local raysCount = 6
    local step = (halfWidth * 2) / (raysCount - 1)
	local hitCharacter
    for i = 0, raysCount - 1 do
        local offsetX = -halfWidth + i * step
        local origin = CS.UnityEngine.Vector2(hitEntityPos.x + offsetX, hitEntityPos.y + halfHeight + 0.01)

        local character = DM.Raycast2DByTag(origin, CS.UnityEngine.Vector2(0,1), 0.1, tag)

        CS.UnityEngine.Debug.DrawRay(
            CS.UnityEngine.Vector3(origin.x, origin.y, 0),
            CS.UnityEngine.Vector3(0, 0.1, 0),
            CS.UnityEngine.Color.green
        )

        if character then
			hitCharacter = character
            break
        end
    end
	if hitCharacter then
		local currentOffset = hitCharacter.transform.position - entity.transform.position

		if not data.hitPosition then
			data.hitPosition = currentOffset
		else
			local maxDistance = 0.1 
			if (currentOffset - data.hitPosition).magnitude > maxDistance then
				data.hitPosition = currentOffset
			end
		end

		local targetPos = entity.transform.position + data.hitPosition
		hitCharacter.transform.position = CS.UnityEngine.Vector3(targetPos.x,hitCharacter.transform.position.y,hitCharacter.transform.position.z)
		data.hitCharacter = hitCharacter
	end

end

local DM = CS.DetectionManager

function StickPlayerUp(entity)
    local tag = "Player"
    local data = entity.dataTable
    local hitEntityTrans = entity.transform
    local hitEntityPos = hitEntityTrans.position
    local colBounds = entity.col.bounds
    local halfWidth = colBounds.extents.x
    local halfHeight = colBounds.extents.y
    local raysCount = 12
    local step = (halfWidth * 2) / (raysCount - 1)
    local hitCharacter = nil

    -- 🌿 射线检测玩家（上方向）
    for i = 0, raysCount - 1 do
        local offsetX = -halfWidth + i * step
        local origin = CS.UnityEngine.Vector2(
            hitEntityPos.x + offsetX,
            hitEntityPos.y + halfHeight + 0.02
        )

        local character = DM.Raycast2DByTag(origin, CS.UnityEngine.Vector2(0, 1), 0.3, tag)

        CS.UnityEngine.Debug.DrawRay(
            CS.UnityEngine.Vector3(origin.x, origin.y, 0),
            CS.UnityEngine.Vector3(0, 0.2, 0),
            CS.UnityEngine.Color.green
        )

        if character then
            hitCharacter = character
            break
        end
    end

    -- 📌 检测到角色
    if hitCharacter then
        data.hitCharacter = hitCharacter

        -- 🔗 设置玩家为平台子物体
        hitCharacter.transform:SetParent(hitEntityTrans, true) -- true 保持世界坐标

        return
    end

    -- ❌ 离开滑块时，清空记录并取消父对象
    if data.hitCharacter then
        data.hitCharacter.transform:SetParent(nil, true) -- 保持世界坐标
    end
    data.hitCharacter = nil
    data.hitLocalPosition = nil
end
